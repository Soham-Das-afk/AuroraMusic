version: '3.8'

services:
  auroramusic:
    build: .
    working_dir: /app
    volumes:
      - ./data:/app/src/data
      - ./downloads:/app/src/downloads
      - ./cookies:/app/src/cookies:ro
      - ./.env:/app/.env
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - SPOTIFY_CLIENT_ID=${SPOTIFY_CLIENT_ID}
      - SPOTIFY_CLIENT_SECRET=${SPOTIFY_CLIENT_SECRET}
      - ALLOWED_GUILD_IDS=${ALLOWED_GUILD_IDS}
      - YOUTUBE_COOKIES=${YOUTUBE_COOKIES}
      # Optional command-sync / rate-limit protection settings
      - ENABLE_GLOBAL_COMMAND_SYNC=${ENABLE_GLOBAL_COMMAND_SYNC}
      - COMMAND_SYNC_RETRIES=${COMMAND_SYNC_RETRIES}
      - COMMAND_SYNC_BACKOFF_BASE=${COMMAND_SYNC_BACKOFF_BASE}
      - GLOBAL_COMMAND_SYNC_OFFPEAK_ENABLED=${GLOBAL_COMMAND_SYNC_OFFPEAK_ENABLED}
      - GLOBAL_COMMAND_SYNC_OFFPEAK_START_HOUR_UTC=${GLOBAL_COMMAND_SYNC_OFFPEAK_START_HOUR_UTC}
      - GLOBAL_COMMAND_SYNC_OFFPEAK_END_HOUR_UTC=${GLOBAL_COMMAND_SYNC_OFFPEAK_END_HOUR_UTC}
      - GLOBAL_COMMAND_SYNC_RETRY_INTERVAL_SECONDS=${GLOBAL_COMMAND_SYNC_RETRY_INTERVAL_SECONDS}
      - GLOBAL_COMMAND_SYNC_MAX_ATTEMPTS_IN_WINDOW=${GLOBAL_COMMAND_SYNC_MAX_ATTEMPTS_IN_WINDOW}
    restart: unless-stopped
    command: python src/bot.py